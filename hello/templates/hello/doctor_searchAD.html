<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    {% load static %}
    <link rel="stylesheet" type="text/css" href="{% static 'hello/patientAdd2.css' %}" />
</head>
<body>
    <div class="dashUBod">
        <div class="overlayTop">
            <a class="logoCorection" href="{% url 'patient_dashboard' %}">
            <svg width="75" height="75" viewBox="0 0 75 75" fill="none" xmlns="http://www.w3.org/2000/svg">
            <rect width="75" height="75" rx="15" fill="#6C63FF"/>
            <path d="M44 8C46.2091 8 48 9.79086 48 12V28H64C66.2091 28 68 29.7909 68 32V44C68 46.2091 66.2091 48 64 48H48V64C48 66.2091 46.2091 68 44 68H32C29.7909 68 28 66.2091 28 64V48H12C9.79086 48 8 46.2091 8 44V32C8 29.7909 9.79086 28 12 28H28V12C28 9.79086 29.7909 8 32 8H44Z" fill="white"/>
            <path d="M40.5 60.5C40.1878 62.061 38.1259 63.7686 37.2926 63.9353C36.5413 64.1776 36.4864 63.0477 37.2926 61.4353C38.7926 58.4353 36.0604 57.703 34.2926 55.9353C31.2926 52.9353 30.3794 46.7515 38.2926 42.4352C43.7926 39.4352 43.503 37.2904 37.7926 34.4352C34.7926 32.9352 29.7301 27.9352 31.2926 22.9352C32.8045 19.5294 34.5852 18.5567 37.7926 18.5284C40.15 18.5075 40.6134 18.5284 42.5 19C44 19.375 44.5146 21.9647 44 22.5C43 22.9352 41.1108 23.3185 39.7926 22.4352C35.7926 21.9352 32.5629 25.7949 41.7926 31.4352C50.7926 36.9352 45.2926 43.6852 38.7926 46.9352C34.7926 48.9352 35.7926 52.9353 37.7926 54.4353C39.7926 55.9353 41 58 40.5 60.5Z" fill="#6C63FF"/>
            </svg>
            </a>
            <div class="infoBox">
                    <div class="dashboardTextColumn">
                        <a class="noUnderline" href="{% url 'doctor_search' %}">
                        <div class="dashboardText">Patient Add
                            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="23" viewBox="0 0 14 23" fill="none">
                            <path fill-rule="evenodd" clip-rule="evenodd" d="M12.8553 12.8553C13.6037 12.1068 13.6037 10.8932 12.8553 10.1447L3.27196 0.561372C2.52345 -0.187124 1.30989 -0.187124 0.561373 0.561372C-0.187124 1.30989 -0.187124 2.52344 0.561373 3.27196L8.78945 11.5L0.561373 19.7281C-0.187124 20.4765 -0.187124 21.6901 0.561373 22.4386C1.30989 23.1871 2.52345 23.1871 3.27196 22.4386L12.8553 12.8553Z" fill="black"/>
                            </svg>
                        </div>
                        </a>
                    </div>
            </div>
                <div class="helloBox">
                    <div id="currentTime" class="dateDisplay2"></div>
                    <div class="vertSep"></div>
                    <div class="dateDisplay"><span id="day"></span></div>
                    <div class="dateDisplay2" id="monthYear"></div>
                </div>
            
            <div class="logoutBox">
                <a href="{% url 'settingsP' %}">
                    <svg xmlns="http://www.w3.org/2000/svg" width="27" height="27" viewBox="0 0 27 27" fill="none">
                    <path d="M13.5001 12.6162C15.0025 12.6162 16.4433 11.9516 17.5057 10.7686C18.568 9.58562 19.1648 7.98113 19.1648 6.30811C19.1648 4.6351 18.568 3.0306 17.5057 1.8476C16.4433 0.664603 15.0025 0 13.5001 0C11.9977 0 10.5568 0.664603 9.49449 1.8476C8.43214 3.0306 7.83532 4.6351 7.83532 6.30811C7.83532 7.98113 8.43214 9.58562 9.49449 10.7686C10.5568 11.9516 11.9977 12.6162 13.5001 12.6162ZM13.5001 15.3877C5.96841 15.3877 1.14019 22.2695 1.14019 22.2695C1.14019 22.2695 -1.42525 25.3161 1.14019 26.4774C2.53923 27.1742 24.4605 27.1742 25.86 26.4774C28.425 25.3161 25.86 22.2695 25.86 22.2695C25.86 22.2695 21.2891 15.3877 13.5001 15.3877Z" fill="#9BAAF5"/>
                    </svg>
                </a>
                <a class="logoutButton" href="{% url 'logout' %}">
                    <svg xmlns="http://www.w3.org/2000/svg" width="30" height="24" viewBox="0 0 30 24" fill="none">
                    <path d="M28 2V22" stroke="#9BAAF5" stroke-width="2.5" stroke-linecap="round"/>
                    <path d="M2 10.75C1.30964 10.75 0.75 11.3096 0.75 12C0.75 12.6904 1.30964 13.25 2 13.25L2 10.75ZM25.8839 12.8839C26.372 12.3957 26.372 11.6043 25.8839 11.1161L17.9289 3.16116C17.4408 2.67301 16.6493 2.67301 16.1612 3.16116C15.673 3.64932 15.673 4.44078 16.1612 4.92893L23.2322 12L16.1612 19.0711C15.673 19.5592 15.673 20.3507 16.1612 20.8388C16.6493 21.327 17.4408 21.327 17.9289 20.8388L25.8839 12.8839ZM2 12L2 13.25L25 13.25L25 12L25 10.75L2 10.75L2 12Z" fill="#9BAAF5"/>
                    </svg>
                </a>

            </div>

        </div>
    </div>
    <div class="dashLBod">
        <div class="overlayBottom">
            <div class="rowAlign1">
                <div class="search-wrapper">
            <svg class="search-icon" xmlns="http://www.w3.org/2000/svg" width="39" height="39" viewBox="0 0 39 39" fill="none">
            <g clip-path="url(#clip0_64_19)">
                <path d="M15.3853 -0.0124363C15.4335 -0.0123638 15.4817 -0.0122912 15.5313 -0.0122165C16.2452 -0.0104077 16.9453 0.00585191 17.6514 0.119388C17.6951 0.126217 17.7388 0.133046 17.7838 0.140082C20.5202 0.579283 23.1248 1.69972 25.2446 3.50204C25.2867 3.53723 25.3288 3.57242 25.3709 3.60759C25.8965 4.04975 26.4071 4.51439 26.86 5.03179C26.9193 5.09945 26.9792 5.16652 27.0391 5.23363C27.97 6.28391 28.7412 7.48606 29.3394 8.7551C29.3534 8.78454 29.3674 8.81398 29.3818 8.84431C30.3431 10.8847 30.8189 13.106 30.8203 15.3587C30.8204 15.4164 30.8204 15.4164 30.8204 15.4753C30.8179 17.7478 30.3197 19.9953 29.3394 22.0469C29.323 22.082 29.3065 22.117 29.2895 22.1531C29.0881 22.5791 28.8643 22.9863 28.6142 23.3858C28.5948 23.4172 28.5753 23.4486 28.5552 23.481C28.5378 23.5086 28.5203 23.5363 28.5023 23.5648C28.4558 23.6427 28.4558 23.6427 28.4648 23.7582C28.5298 23.841 28.5298 23.841 28.6192 23.9268C28.6536 23.9614 28.688 23.9959 28.7235 24.0316C28.7623 24.07 28.8012 24.1083 28.84 24.1467C28.8808 24.1875 28.9216 24.2283 28.9623 24.2691C29.0748 24.3815 29.1876 24.4935 29.3004 24.6055C29.422 24.7263 29.5431 24.8473 29.6643 24.9684C29.8746 25.1783 30.0851 25.3879 30.2957 25.5975C30.6007 25.9009 30.9053 26.2048 31.2097 26.5087C31.7042 27.0025 32.1988 27.496 32.6937 27.9894C32.7233 28.019 32.753 28.0485 32.7835 28.079C33.1138 28.4082 33.4441 28.7375 33.7746 29.0666C33.8042 29.0961 33.8339 29.1257 33.8644 29.1561C33.9089 29.2004 33.9089 29.2004 33.9542 29.2455C34.0139 29.305 34.0736 29.3645 34.1333 29.424C34.1629 29.4534 34.1924 29.4828 34.2228 29.5131C34.7155 30.0039 35.2078 30.4952 35.6999 30.9867C36.0033 31.2898 36.307 31.5925 36.6111 31.8948C36.8198 32.1023 37.0282 32.3101 37.2362 32.5183C37.3561 32.6382 37.4762 32.7579 37.5967 32.8773C37.7073 32.9868 37.8175 33.0968 37.9272 33.2071C37.9668 33.2467 38.0065 33.2861 38.0464 33.3253C38.5811 33.8514 38.988 34.5295 39.012 35.296C39.0125 35.3807 39.0127 35.4655 39.0124 35.5502C39.0131 35.592 39.0137 35.6339 39.0144 35.677C39.0146 36.0992 38.9285 36.481 38.7341 36.856C38.7162 36.8933 38.7162 36.8933 38.6979 36.9314C38.2693 37.779 37.3892 38.5553 36.5046 38.8817C35.6883 39.1277 34.8595 39.0447 34.107 38.6549C33.75 38.4516 33.4634 38.1651 33.1759 37.8755C33.135 37.8345 33.094 37.7936 33.053 37.7526C32.9412 37.6409 32.8297 37.529 32.7182 37.4169C32.5976 37.2959 32.4768 37.1751 32.356 37.0542C32.1471 36.8451 31.9383 36.6358 31.7295 36.4264C31.4278 36.1237 31.1258 35.8212 30.8237 35.5188C30.3336 35.028 29.8437 34.5371 29.3539 34.046C28.8783 33.5691 28.4025 33.0923 27.9266 32.6156C27.8973 32.5862 27.8679 32.5568 27.8377 32.5265C27.6904 32.379 27.5431 32.2315 27.3959 32.0839C26.175 30.861 24.9544 29.6377 23.7339 28.4143C23.6445 28.4654 23.555 28.5165 23.4656 28.5677C23.4403 28.5821 23.4151 28.5965 23.3891 28.6113C23.2654 28.6821 23.1418 28.7531 23.0188 28.8253C21.2416 29.8538 19.2485 30.4775 17.2141 30.7224C17.1772 30.7271 17.1403 30.7318 17.1024 30.7366C14.363 31.0705 11.5339 30.5627 9.02446 29.449C8.99151 29.4344 8.95855 29.4199 8.92459 29.4049C7.50225 28.7708 6.21379 27.8757 5.06461 26.8294C5.00026 26.7709 4.93554 26.7128 4.8705 26.655C4.55507 26.3746 4.25061 26.0839 3.97647 25.7624C3.91195 25.687 3.84668 25.6125 3.7808 25.5382C1.2424 22.6662 -0.118729 18.7975 0.0298161 14.4807C0.0315216 14.4515 0.0332272 14.4223 0.0349845 14.3922C0.153894 12.4178 0.662251 10.5002 1.5107 8.71531C1.52698 8.68076 1.54326 8.64622 1.56003 8.61063C2.33096 6.98498 3.41792 5.57328 4.68119 4.30293C4.7089 4.27501 4.7366 4.24709 4.76515 4.21833C4.94603 4.03782 5.13274 3.86672 5.32722 3.70102C5.35256 3.67937 5.3779 3.65771 5.40401 3.6354C6.26528 2.90484 7.19399 2.28362 8.1896 1.75102C8.21968 1.73475 8.24977 1.71847 8.28076 1.7017C9.7421 0.917875 11.3504 0.421354 12.9826 0.151722C13.0382 0.142464 13.0382 0.142464 13.0949 0.133019C13.8572 0.0137956 14.6147 -0.0148459 15.3853 -0.0124363ZM8.56993 7.2676C8.52555 7.30668 8.48086 7.34541 8.43597 7.3839C7.89069 7.85366 7.37727 8.36849 6.95719 8.95408C6.92834 8.99352 6.92834 8.99352 6.89891 9.03375C6.47416 9.61484 6.11283 10.2141 5.80428 10.8643C5.79122 10.8913 5.77816 10.9183 5.7647 10.9461C5.26703 11.9804 4.97995 13.1092 4.85015 14.2469C4.84635 14.2793 4.84254 14.3116 4.83862 14.3449C4.63205 16.3099 5.01072 18.3296 5.88379 20.0969C5.89963 20.1291 5.91546 20.1613 5.93178 20.1945C6.1505 20.6347 6.39278 21.0504 6.6789 21.45C6.69724 21.4757 6.71558 21.5014 6.73447 21.5278C7.30826 22.3251 7.96561 23.078 8.74618 23.6786C8.78507 23.7098 8.82397 23.7409 8.86405 23.7731C10.9931 25.4696 13.8096 26.2702 16.5121 25.9861C18.7373 25.7242 20.8251 24.8443 22.4866 23.3266C22.5717 23.2493 22.6579 23.174 22.745 23.099C23.0169 22.8614 23.264 22.6024 23.4954 22.3255C23.5118 22.3061 23.5282 22.2867 23.545 22.2667C25.3796 20.0814 26.2546 17.2417 26.0124 14.4011C25.9028 13.2827 25.621 12.1698 25.1651 11.1429C25.1412 11.0886 25.1412 11.0886 25.1167 11.0332C24.7415 10.1934 24.276 9.42754 23.6942 8.71531C23.6737 8.69021 23.6532 8.66511 23.6321 8.63925C23.165 8.07222 22.6496 7.52902 22.0642 7.08367C22.018 7.04727 21.9718 7.01084 21.9255 6.97439C20.6094 5.94851 19.0789 5.26634 17.4451 4.94464C17.385 4.93277 17.385 4.93277 17.3237 4.92066C16.6979 4.80378 16.0783 4.76021 15.4425 4.76307C15.3905 4.7632 15.3905 4.7632 15.3376 4.76333C12.8777 4.77306 10.4244 5.62842 8.56993 7.2676Z" fill="#9BAAF5"/>
                <path d="M5.36697 3.66122C5.39321 3.67436 5.41945 3.68749 5.44648 3.70102C4.93483 4.21319 4.42318 4.72537 3.89602 5.25306C3.86979 5.23993 3.84355 5.2268 3.81651 5.21327C4.10774 4.89624 4.40221 4.58306 4.70604 4.27806C4.74424 4.23955 4.74424 4.23955 4.78322 4.20026C4.93836 4.04544 5.09846 3.89848 5.26442 3.75535C5.29951 3.72499 5.33418 3.69405 5.36697 3.66122Z" fill="#5D5D5D"/>
            </g>
            <defs>
                <clipPath id="clip0_64_19">
                <rect width="39" height="39" fill="white"/>
                </clipPath>
            </defs>
            </svg>
            <!-- <input type="text" class="search-input" /> -->
            <input type="text" id="doctorSearch" placeholder="Search patients..." class="search-input"/>
            </div>
            
            <div class="sortContainer">
                <button id="sortDropdownBtn" class="sortDropdownBtn" onclick="toggleSortOptions()">
                    Sort by                    
                </button>
                <div class="smallArrow">
                        <svg xmlns="http://www.w3.org/2000/svg" width="23" height="14" viewBox="0 0 23 14" fill="none">
                        <path fill-rule="evenodd" clip-rule="evenodd" d="M10.1447 12.8553C10.8932 13.6037 12.1068 13.6037 12.8553 12.8553L22.4386 3.27196C23.1871 2.52345 23.1871 1.30989 22.4386 0.561373C21.6901 -0.187124 20.4766 -0.187124 19.728 0.561373L11.5 8.78945L3.27194 0.561373C2.52348 -0.187124 1.30985 -0.187124 0.561394 0.561373C-0.187065 1.30989 -0.187065 2.52345 0.561394 3.27196L10.1447 12.8553Z" fill="white"/>
                        </svg>
                </div>
                <div id="sortOptions" class="sortOptionsOverlay">
                    <div onclick="sortDoctors('none')">None</div>
                    <section class="noClass"> </section>
                    <div onclick="sortDoctors('recent')">Recent</div>
                    <section class="noClass"> </section>
                    <div onclick="sortDoctors('name')">Name</div>
                    <section class="noClass"> </section>
                    <div onclick="sortDoctors('hospital')">City</div>
                </div>
            </div>
            <!-- <div class="sortBox">
                Sort By 
                <div class="smallArrow"></div>
                <svg xmlns="http://www.w3.org/2000/svg" width="23" height="14" viewBox="0 0 23 14" fill="none">
                <path fill-rule="evenodd" clip-rule="evenodd" d="M10.1447 12.8553C10.8932 13.6037 12.1068 13.6037 12.8553 12.8553L22.4386 3.27196C23.1871 2.52345 23.1871 1.30989 22.4386 0.561373C21.6901 -0.187124 20.4766 -0.187124 19.728 0.561373L11.5 8.78945L3.27194 0.561373C2.52348 -0.187124 1.30985 -0.187124 0.561394 0.561373C-0.187065 1.30989 -0.187065 2.52345 0.561394 3.27196L10.1447 12.8553Z" fill="white"/>
                </svg>
            </div> -->
            </div>
            <div class="sepLine"></div>

            <div class="rowAlign2">
                <ul class="boxList" id="doctorList">
                    <div id="doctorList">
                    {% for pt in patients %}
                    
                    <li class="doctorItem"
                        data-username="{{ pt.user.username }}"
                        data-hospital="{{ pt.user.doctorinfo.city }}"
                        data-index="{{ forloop.counter }}">
                        <div>
                            {% if pt.user.doctorinfo.photo %}
                                <img src="{{ pt.user.doctorinfo.photo.url }}" alt="Doctor Photo" class="custom-photo-class">
                            {% else %}
                                <svg xmlns="http://www.w3.org/2000/svg" width="88" height="88" viewBox="0 0 88 88" fill="none">
                                <circle cx="44" cy="44" r="43.5" stroke="#D9D9D9"/>
                                <path d="M43.9446 42.1599C47.1658 42.1599 50.255 40.7292 52.5327 38.1824C54.8104 35.6357 56.09 32.1816 56.09 28.58C56.09 24.9783 54.8104 21.5242 52.5327 18.9775C50.255 16.4307 47.1658 15 43.9446 15C40.7234 15 37.6342 16.4307 35.3565 18.9775C33.0788 21.5242 31.7992 24.9783 31.7992 28.58C31.7992 32.1816 33.0788 35.6357 35.3565 38.1824C37.6342 40.7292 40.7234 42.1599 43.9446 42.1599ZM43.9446 48.1263C27.7965 48.1263 17.4446 62.9413 17.4446 62.9413C17.4446 62.9413 11.9442 69.5 17.4446 72C20.4442 73.5 67.4442 73.5 70.4446 72C75.9442 69.5 70.4446 62.9413 70.4446 62.9413C70.4446 62.9413 60.6444 48.1263 43.9446 48.1263Z" fill="#DEDCDC"/>
                                </svg>
                            {% endif %}
                            
                        </div>
                        <div class="nameDr">
                            <div>{{ pt.user.username }}</div>
                            <div class="specDr">{{ pt.user.doctorinfo.social_security_number }}</div>
                        </div>
                        <div class="sepDr"></div>
                        <div class="hospDr">
                            <div>{{ pt.user.doctorinfo.home_address }}</div>
                            <div class="specDr">{{ pt.user.doctorinfo.city }}</div>
                        </div>
                        <div class="sepDr"></div>
                        <div class="hospDr">
                            <div>{{ pt.user.email }}</div>
                            <div class="specDr">{{ pt.user.doctorinfo.phone_number}}</div>
                        </div>

                       {% if pt.id in assigned_patient_ids %}
                            <form method="post" action="{% url 'remove_patient' pt.id %}">
                                {% csrf_token %}
                                <button class="addBut" type="submit">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" fill="none">
                                    <circle cx="10" cy="10" r="10" fill="#6C63FF"/>
                                    <path d="M16 10H4" stroke="white" stroke-width="2" stroke-linecap="round"/>
                                    </svg>
                                </button>
                            </form>
                        {% else %}
                            <form method="post" action="{% url 'add_patient' pt.id %}">
                                {% csrf_token %}
                                <button class="addBut" type="submit">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" fill="none">
                                    <circle cx="10" cy="10" r="10" fill="#6C63FF"/>
                                    <path d="M10 4V16" stroke="white" stroke-width="2" stroke-linecap="round"/>
                                    <path d="M16 10H4" stroke="white" stroke-width="2" stroke-linecap="round"/>
                                    </svg>
                                </button>
                            </form>
                        {% endif %}

                    </li>
                    {% empty %}
                    <li>No patients avaliable.</li>
                    {% endfor %}
                    </div>
                </ul>
            </div>


            
            
        </div>
    </div>

    <script>
        document.addEventListener('click', function(event) {
            const dropdown = document.getElementById('sortOptions');
            const button = document.getElementById('sortDropdownBtn');

            // If the click is outside the dropdown and button, close the dropdown
            if (dropdown.style.display === 'block' &&
                !dropdown.contains(event.target) &&
                !button.contains(event.target)) {
                dropdown.style.display = 'none';
            }
        });

    function toggleSortOptions() {
        const options = document.getElementById('sortOptions');
        options.style.display = options.style.display === 'block' ? 'none' : 'block';
    }

    const originalOrder = [];

    document.addEventListener('DOMContentLoaded', () => {
    const list = document.getElementById('doctorList');
    originalOrder.length = 0; // clear if needed
    for (let child of list.children) {
        originalOrder.push(child.cloneNode(true)); // deep clone
    }
    });

    function sortDoctors(criteria) {
        const list = document.getElementById('doctorList');
        const items = Array.from(list.getElementsByClassName('doctorItem'));
        const button = document.getElementById('sortDropdownBtn');
        const optionsBox = document.getElementById('sortOptions');

        let sorted;

        if (criteria === 'recent') {
            sorted = items.reverse();
            button.textContent = 'Recent';
        } else if (criteria === 'name') {
            sorted = items.sort((a, b) =>
                a.dataset.username.localeCompare(b.dataset.username)
            );
            button.textContent = 'Name';
        } else if (criteria === 'hospital') {
            sorted = items.sort((a, b) =>
                a.dataset.hospital.localeCompare(b.dataset.hospital)
            );
            button.textContent = 'City';
        } else if (criteria === 'none') {
            list.innerHTML = '';
            originalOrder.forEach(clone => list.appendChild(clone.cloneNode(true)));
            button.textContent = 'Sort by';
            optionsBox.style.display = 'none'; // ✅ move this before return
            return;
        }

        optionsBox.style.display = 'none'; // ✅ always hide options after choosing
        list.innerHTML = '';
        sorted.forEach(item => list.appendChild(item));
    }
    </script>

    <script>
    document.getElementById('doctorSearch').addEventListener('input', function () {
        const filter = this.value.toLowerCase();
        const listItems = document.querySelectorAll('#doctorList li');

        listItems.forEach(function (li) {
        const text = li.textContent.toLowerCase();
        li.style.display = text.includes(filter) ? '' : 'none';
        });
    });
    </script>

    <script>
        const date = new Date();
        const day = date.getDate();
        const monthNames = ["January", "February", "March", "April", "May", "June",
                            "July", "August", "September", "October", "November", "December"];
        const month = monthNames[date.getMonth()];
        const year = date.getFullYear();

        document.getElementById("day").textContent = day;
        document.getElementById("monthYear").textContent = `${month} ${year}`;
        const now = new Date();
        const hours = String(now.getHours()).padStart(2, '0');
        const minutes = String(now.getMinutes()).padStart(2, '0');
        document.getElementById('currentTime').textContent = `${hours}:${minutes}`;
    </script>
    <!-- <h1>Welcome {{ request.user.username }}</h1>
    <h2>Your Doctors</h2>
    {% for dr in assigned_doctors %}
    <li>
        <a href="{% url 'doctor_scans' doctor_id=pt.doctor.id %}">{{ pt.doctor.username }}</a>
    </li>
    {% empty %}
    <li>No doctors assigned yet.</li>
    {% endfor %}

    <a href="{% url 'logout' %}">Logout</a> -->
</body>
</html>